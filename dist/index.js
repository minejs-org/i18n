var u=class{constructor(t){this.translations={};this.currentLanguage="en";this.defaultLanguage="en";this.supportedLanguages=new Set(["en"]);this.rtlLanguages=new Set(["ar","he","fa","ur","yi","ji","iw","ku"]);this.listeners=new Set;t&&(this.defaultLanguage=t.defaultLanguage||"en",this.currentLanguage=t.defaultLanguage||"en",this.storage=t.storage,this.onLanguageChange=t.onLanguageChange,t.supportedLanguages&&(this.supportedLanguages=new Set(t.supportedLanguages)));}async init(){if(this.storage){let t=await this.storage.get("i18n-language");t&&this.supportedLanguages.has(t)&&(this.currentLanguage=t);}}loadLanguage(t,e){this.translations[t]||(this.translations[t]={});let a=this.flattenObject(e);this.translations[t]={...this.translations[t],...a},this.supportedLanguages.add(t);}loadTranslations(t){Object.entries(t).forEach(([e,a])=>{this.loadLanguage(e,a);});}flattenObject(t,e=""){let a={};for(let r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;let i=t[r],s=e?`${e}.${r}`:r;typeof i=="object"&&i!==null&&!Array.isArray(i)?Object.assign(a,this.flattenObject(i,s)):a[s]=String(i);}return a}t(t,e){let a=this.getTranslation(t);return e&&Object.entries(e).forEach(([r,i])=>{let s=this.getTranslation(i,i);a=a.replace(new RegExp(`\\{${r}\\}`,"g"),s);}),a}getTranslation(t,e){return this.translations[this.currentLanguage]?.[t]?this.translations[this.currentLanguage][t]:this.defaultLanguage!==this.currentLanguage&&this.translations[this.defaultLanguage]?.[t]?this.translations[this.defaultLanguage][t]:(console.warn(`[i18n] Translation key not found: "${t}" (lang: ${this.currentLanguage})`),e||t)}tLang(t,e,a){let r=this.currentLanguage;this.currentLanguage=e;let i=this.t(t,a);return this.currentLanguage=r,i}tParse(t,e){let a=this.t(t,e);a=a.replace(/\\n|\/n/g,"<br>");let r=[],i=/<([a-z]+)>([^<]*)<\/\1>|<([a-z]+)\s*\/?>|([^<]+)/gi,s;for(;(s=i.exec(a))!==null;)s[4]?r.push({type:"text",content:s[4]}):s[1]?r.push({type:"tag",tag:s[1],content:s[2]}):s[3]&&r.push({type:"tag",tag:s[3],content:""});return r.length>0?r:[{type:"text",content:a}]}async setLanguage(t){this.supportedLanguages.has(t)&&(this.currentLanguage=t,this.storage&&await this.storage.set("i18n-language",t),this.listeners.forEach(e=>e(t)),this.onLanguageChange&&this.onLanguageChange(t));}getLanguage(){return this.currentLanguage}getSupportedLanguages(){return Array.from(this.supportedLanguages)}isLanguageSupported(t){return this.supportedLanguages.has(t)}hasKey(t){return !!(this.translations[this.currentLanguage]?.[t]||this.translations[this.defaultLanguage]?.[t])}getTranslations(){return this.translations[this.currentLanguage]||{}}isRTL(){return this.rtlLanguages.has(this.currentLanguage.toLowerCase().substring(0,2))}isRTLLanguage(t){return this.rtlLanguages.has(t.toLowerCase().substring(0,2))}onChange(t){return this.listeners.add(t),()=>this.listeners.delete(t)}};var h=()=>({get:n=>typeof localStorage>"u"?null:localStorage.getItem(n),set:(n,t)=>{typeof localStorage<"u"&&localStorage.setItem(n,t);}}),L=()=>{let n=new Map;return {get:t=>n.get(t)||null,set:(t,e)=>{n.set(t,e);}}},y=()=>typeof localStorage<"u"?h():L(),p=class{constructor(t,e,a="json"){this.loading=new Map;this.loaded=new Set;this.baseUrl=t.endsWith("/")?t:t+"/",this.manager=e,this.fileExtension=a,this.isServerSide=typeof fetch>"u";}async load(t){if(this.loaded.has(t))return;if(this.loading.has(t))return this.loading.get(t);let e=this.doLoad(t);this.loading.set(t,e);try{await e,this.loaded.add(t);}finally{this.loading.delete(t);}}async doLoad(t){try{let e=`${this.baseUrl}${t}.${this.fileExtension}`,a;e.startsWith(".")||e.startsWith("/")||/^[a-zA-Z]:/.test(e)||this.isServerSide?a=await this.loadFromFile(e):a=await this.loadFromUrl(e),a&&this.manager.loadLanguage(t,a);}catch(e){console.warn(`[i18n] Error loading language: ${t}`,e);}}async loadFromUrl(t){try{let e=await fetch(t);return e.ok?await e.json():(console.warn(`[i18n] Failed to load language from URL: ${t} (${e.status})`),null)}catch(e){return console.warn(`[i18n] Error fetching from URL: ${t}`,e),null}}async loadFromFile(t){try{let e=await import('fs').then(s=>s.promises).catch(()=>null),a=await import('path').then(s=>s).catch(()=>null);if(!e)return console.warn("[i18n] fs module not available. Running in browser?"),null;let r=t;if(a&&!a.isAbsolute(t)){let s=await import('process').then(c=>c).catch(()=>null);s&&(r=a.resolve(s.cwd(),t));}let i=await e.readFile(r,"utf-8");return JSON.parse(i)}catch(e){return console.warn(`[i18n] Error reading file: ${t}`,e),null}}isLoaded(t){return this.loaded.has(t)}},g=null,l=null;function f(){return typeof navigator<"u"&&navigator.language?navigator.language.split("-")[0].toLowerCase():"en"}function w(){return typeof fetch<"u"&&typeof window<"u"}function o(){return g||(g=new u),g}function v(){return l}async function b(n){if(w()&&!n.defaultLanguage){let t=f();n.supportedLanguages?.includes(t)?n.defaultLanguage=t:n.defaultLanguage=n.supportedLanguages?.[0]||"en";}if(n.storage||(n.storage=y()),g=new u(n),await g.init(),n.basePath){let t=n.fileExtension||"json";l=new p(n.basePath,g,t),await l.load(g.getLanguage());}return g}var d=(n,t)=>o().t(n,t),m=(n,t,e)=>o().tLang(n,t,e),C=(n,t)=>o().tParse(n,t),S=n=>l&&!l.isLoaded(n)?l.load(n).then(()=>o().setLanguage(n)):o().setLanguage(n),x=()=>o().getLanguage(),R=()=>o().getSupportedLanguages(),T=n=>o().hasKey(n),I=()=>o().isRTL(),P=n=>o().isRTLLanguage(n),$=n=>o().onChange(n),E=(n,t)=>o().loadLanguage(n,t),j=n=>o().loadTranslations(n);function M(n,t,e){return d(n===1?t:e,{count:String(n)})}var F={setupI18n:b,getI18n:o,getLazyLoader:v,I18nManager:u,LazyLoader:p,t:d,tLang:m,tParse:C,setLanguage:S,getLanguage:x,getSupportedLanguages:R,hasKey:T,isRTL:I,isRTLLanguage:P,onChange:$,loadLanguage:E,loadTranslations:j,plural:M};export{u as I18nManager,p as LazyLoader,F as default,o as getI18n,x as getLanguage,v as getLazyLoader,R as getSupportedLanguages,T as hasKey,I as isRTL,P as isRTLLanguage,E as loadLanguage,j as loadTranslations,$ as onChange,M as plural,S as setLanguage,b as setupI18n,d as t,m as tLang,C as tParse};//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map